<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>TOEFL / SAT — Practice Sample | UniQuest</title>
  <link rel="icon" href="images/logo.png" type="image/png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="style-steps.css">
  <style>
    body {font-family: system-ui, sans-serif; background:#f9fafb; color:#222; line-height:1.6;}
    h1,h2,h3 {font-weight:600;}
    .container {max-width:1280px; margin:2rem auto; padding:1rem;}
    .grid {display:grid; grid-template-columns:1fr 760px; gap:1.5rem;}
    .panel {background:#fff; border:1px solid #e6e6e6; padding:1.5rem; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,.05);}
    .controls {display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.5rem;}
    .btn {display:inline-block; padding:.65rem 1.1rem; border-radius:8px; text-decoration:none; font-weight:500;
          background:#2563eb; color:#fff; border:none; cursor:pointer; transition:background .2s, transform .1s;}
    .btn:hover {background:#1e4ed8; transform:translateY(-1px);} 
    .btn.secondary {background:#e5e7eb; color:#111;} .btn.secondary:hover {background:#d1d5db;}
    .primary-large {padding:.85rem 1.4rem; font-size:1.05rem; border-radius:10px}
    .btn.ghost {background:transparent; color:#2563eb; border:1px solid #cfe1ff}
    iframe.pdf-viewer {width:100%; height:900px; border:1px solid #ddd; border-radius:8px;}
    table.info {width:100%; border-collapse:collapse; margin-top:.75rem;}
    table.info th, table.info td {padding:.6rem; border-bottom:1px solid #f0f0f0; text-align:left;}
    table.info th {background:#f3f4f6; font-weight:600;}
    .timer {font-weight:700; font-size:1.4rem; color:#111;}
    .answers-list {max-height:300px; overflow:auto; border:1px dashed #ddd; padding:.75rem; border-radius:8px; background:#f9fafb; font-size:.95rem;}
    label.small {display:block; font-size:.85rem; margin-top:.5rem; font-weight:500;}
    input[type=number], select, input[type=text] {padding:.4rem; border:1px solid #ccc; border-radius:6px;}
    input[type=number] {width:100px;}
    .note {font-size:.95rem; color:#444;}
    .correct {color:green; font-weight:700;}
    .wrong {color:#c03636; font-weight:700;}
    .result-table {width:100%; border-collapse:collapse; margin-top:.75rem;}
    .result-table th, .result-table td {padding:.4rem; border:1px solid #e8e8e8; text-align:center;}
    .result-table th {background:#f6f7fb;}
    .summary {margin-top:.75rem; padding:.6rem; background:#f3f4f6; border-radius:8px;}
    hr {border:0; height:1px; background:#e5e7eb; margin:1.5rem 0;}
    /* new styles for MCQ vertical options */
    .mcq {margin-top:.35rem;}
    .mcq label {display:block; padding:.45rem .6rem; border-radius:6px; cursor:pointer; border:1px solid transparent; margin-bottom:.35rem;}
    .mcq input[type="radio"] {margin-right:.6rem;}
    .mcq label:hover {background:#f3f4ff;}
    .mcq label.selected {background:#eef2ff; border-color:#c7d2fe;}
    .numeric-input {display:none;}
    .section-buttons {display:flex;gap:.6rem;margin-top:.6rem}
    .section-buttons .btn {font-weight:700}
    @media (max-width:1150px){ .grid{grid-template-columns:1fr 480px} iframe.pdf-viewer{height:700px} }
    @media (max-width:800px){ .grid{grid-template-columns:1fr} iframe.pdf-viewer{height:600px} }
  </style>
</head>
<body>
  <div id="header"></div>
  <script src="header.js"></script>

  <section style="height:240px; background:linear-gradient(rgba(0,0,0,.5),rgba(0,0,0,.5)), url('images/test.jpg') center/cover no-repeat; display:flex; align-items:center; justify-content:center; color:white; text-align:center;">
    <div>
      <h1 style="font-size:2rem;">Interactive Practice — SAT sample</h1>
      <p style="font-size:1.1rem; opacity:.95">Simulate real exam conditions with timers, modules, and answer recording.</p>
    </div>
  </section>

  <div class="container grid">
    <!-- Left -->
    <div class="panel">
      <h2>Instructions & General Directions</h2>
      <p class="note">You may work on only one module at a time. If you finish a module before time is called, check your work on that module only. You may NOT turn to any other module.</p>
      <ul style="margin-top:.5rem;">
        <li>Use the viewer on the right. The page ranges for each module are set below.</li>
        <li>Mark answers using the Answer Sheet panel. Answers are stored in your browser (localStorage).</li>
        <li>Timers mimic the real test durations and will alert when time's up.</li>
      </ul>

      <h3>Module Timings</h3>
      <table class="info">
        <thead><tr><th>Module</th><th>Time</th><th>pages</th></tr></thead>
        <tbody>
          <tr><td>Reading &amp; Writing — Module 1</td><td>39 minutes</td><td>Pages 12–17</td></tr>
          <tr><td>Reading &amp; Writing — Module 2</td><td>39 minutes</td><td>Pages 18–30</td></tr>
          <tr><td>Math — Module 1</td><td>43 minutes</td><td>Pages 32–39</td></tr>
          <tr><td>Math — Module 2</td><td>43 minutes</td><td>Pages 40–48</td></tr>
        </tbody>
      </table>

      <hr>

      <h3>Quick sections</h3>
      <div class="section-buttons">
        <!-- top-level buttons that jump to the first page of that section -->
        <button class="btn primary-large" id="btn-rw" data-start="12" data-default-mod="rw1">Reading &amp; Writing</button>
        <button class="btn primary-large" id="btn-math" data-start="32" data-default-mod="m1">Math</button>
      </div>

      <h3 style="margin-top:1rem">Modules (click to select)</h3>
      <div class="controls" id="module-controls">
        <button class="btn" data-start="12" data-end="17" data-mins="39" data-name="rw1">Reading &amp; Writing — Module 1</button>
        <button class="btn" data-start="18" data-end="30" data-mins="39" data-name="rw2">Reading &amp; Writing — Module 2</button>
        <button class="btn" data-start="32" data-end="39" data-mins="43" data-name="m1">Math — Module 1</button>
        <button class="btn" data-start="40" data-end="48" data-mins="43" data-name="m2">Math — Module 2</button>
      </div>

      <div style="margin-top:1.2rem; display:flex;align-items:center;gap:1rem;flex-wrap:wrap">
        <div class="timer" id="timer">00:00</div>
        <div id="current-module" style="font-weight:600;color:#374151">Not started</div>
        <div>
          <button id="pause" class="btn secondary" disabled>Start</button>
          <button id="reset" class="btn secondary">Reset</button>
          <button id="finish" class="btn">Finish Module</button>
        </div>
      </div>
    </div>

    <!-- Right -->
    <div>
      <div class="panel" style="margin-bottom:1.2rem">
        <iframe id="pdf-frame" class="pdf-viewer" src="tests/practice/sat-practice-test-4-digital.pdf#page=1"></iframe>
        <div id="pdf-status" style="color:#b33;margin-top:.4rem;font-size:.9rem"></div>
      </div>

      <div class="panel">
        <h3>Answer Sheet</h3>

        <div style="display:flex;gap:.75rem;align-items:flex-end;flex-wrap:wrap">
          <label class="small">Module
            <select id="ans-module">
              <option value="rw1">Reading &amp; Writing - Module 1</option>
              <option value="rw2">Reading &amp; Writing - Module 2</option>
              <option value="m1">Math - Module 1</option>
              <option value="m2">Math - Module 2</option>
            </select>
          </label>

          <label class="small">Q #<input type="number" id="ans-q" min="1"></label>

          <!-- MCQ vertical radio options for RW modules -->
          <div id="mcq-area" class="mcq" aria-label="Multiple choice options">
            <label data-value="A"><input type="radio" name="mcq" value="A"> A) </label>
            <label data-value="B"><input type="radio" name="mcq" value="B"> B) </label>
            <label data-value="C"><input type="radio" name="mcq" value="C"> C) </label>
            <label data-value="D"><input type="radio" name="mcq" value="D"> D) </label>
            <label data-value=""><input type="radio" name="mcq" value=""> (blank) </label>
          </div>

          <!-- Numeric/text input for Math modules (hidden for RW) -->
          <div id="numeric-area" class="numeric-input">
            <label class="small">Numeric answer
              <input type="text" id="ans-choice-text" placeholder="e.g. 45.13 or 361/8">
            </label>
          </div>

          <button id="save-answer" class="btn">Save</button>
          <button id="download-answers" class="btn">Export (CSV)</button>
          <button id="check-answers" class="btn secondary">Check / Grade</button>
        </div>

        <div style="margin-top:.75rem">
          <div class="answers-list" id="answers-list">No answers saved yet.</div>
        </div>

        <div style="margin-top:.75rem; font-size:.9rem; color:#555">
          Answers are stored locally. Use <em>Export (CSV)</em> to download. Click <em>Check / Grade</em> to compare to the answer key and see section scores.
        </div>

        <div id="grading-results" style="margin-top:1rem"></div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="panel">
      <h3>Marking & Test Book Usage</h3>
      <ul>
        <li>Circle only one answer to each question. If you change your mind, erase completely.</li>
        <li>You may use the test book for scratch work, but do not fold or remove pages.</li>
      </ul>
    </div>
  </div>

  <div id="footer"></div>
  <script src="footer.js"></script>

  <script>
  /**************************************************************************
   * Answer-checking + grading implementation (modified input UI)
   **************************************************************************/

  // Correct answer key (unchanged from user's original)
  const CORRECT = {
    rw1: {
      1:"B",2:"A",3:"A",4:"C",5:"A",6:"B",7:"D",8:"B",9:"B",10:"D",
      11:"C",12:"D",13:"A",14:"B",15:"C",16:"A",17:"A",18:"A",19:"A",20:"D",
      21:"D",22:"D",23:"B",24:"C",25:"B",26:"A",27:"C",28:"D",29:"A",30:"A",
      31:"D",32:"D",33:"C"
    },
    rw2: {
      1:"D",2:"D",3:"B",4:"B",5:"B",6:"B",7:"A",8:"C",9:"C",10:"A",
      11:"A",12:"B",13:"D",14:"C",15:"C",16:"A",17:"B",18:"D",19:"C",20:"A",
      21:"B",22:"D",23:"D",24:"A",25:"B",26:"B",27:"A",28:"A",29:"C",30:"C",
      31:"A",32:"A",33:"B"
    },
    m1: {
      1:"B",2:"A",3:"B",4:"D",5:"A",6:"9",7:"10",8:"A",9:"B",10:"D",
      11:"A",12:"C",13:"0.2",14:"80",15:"D",16:"B",17:"B",18:"A",19:"C",20:"100",
      21:"45.13",22:"B",23:"D",24:"C",25:"C",26:"D",27:"5"
    },
    m2: {
      1:"B",2:"B",3:"C",4:"A",5:"A",6:"15",7:"50",8:"B",9:"D",10:"A",
      11:"A",12:"B",13:"0.3",14:"2",15:"A",16:"C",17:"B",18:"D",19:"A",20:"0.882",
      21:"51",22:"A",23:"C",24:"C",25:"D",26:"B",27:"600"
    }
  };

  // Ranges (unchanged)
  const RW_RANGES = [ /* ... existing ranges ... */
    [200,200],[200,200],[200,200],[200,200],[200,200],[200,200],[200,200],
    [200,210],[200,220],[210,230],[230,250],[240,260],[250,270],[260,280],[280,300],[290,310],
    [320,340],[340,360],[350,370],[360,380],[370,390],[370,390],[380,400],[390,410],[400,420],
    [410,430],[420,440],[420,440],[430,450],[440,460],[450,470],[460,480],[460,480],[470,490],
    [480,500],[490,510],[490,510],[500,520],[510,530],[520,540],[530,550],[540,560],[540,560],
    [550,570],[560,580],[570,590],[580,600],[590,610],[590,610],[600,620],[610,630],[620,640],
    [630,650],[630,650],[640,660]
  ];

  const M_RANGES = [
    [200,200],[200,200],[200,200],[200,200],[200,200],[200,200],[200,200],
    [200,220],[200,230],[220,250],[250,280],[280,310],[290,320],[300,330],[310,340],[320,350],
    [330,360],[330,360],[340,370],[350,380],[360,390],[370,400],[370,400],[380,410],[390,420],
    [400,430],[420,450],[430,460],[440,470],[460,490],[470,500],[480,510],[500,530],[510,540],
    [520,550],[530,560],[550,580],[560,590],[570,600],[580,610],[590,620],[600,630],[620,650],
    [630,660],[650,680],[670,690],[680,700],[690,710]
  ];

  // storage helpers
  function loadStored() { return JSON.parse(localStorage.getItem('uq_answers_v3') || '{}'); }
  function storeAnswers(obj) { localStorage.setItem('uq_answers_v3', JSON.stringify(obj)); }

  function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  // render answers (with optional highlighting)
  function renderSavedAnswers(highlight = {}) {
    const data = loadStored();
    const out = document.getElementById('answers-list');
    if (Object.keys(data).length === 0) { out.innerHTML = '<em>No answers saved yet.</em>'; return; }
    let html = '';
    for (const mod of ['rw1','rw2','m1','m2']) {
      if (!data[mod] || Object.keys(data[mod]).length === 0) continue;
      const label = modLabel(mod);
      html += `<div style="margin-bottom:.6rem"><strong>${label}</strong><ul style="margin:.4rem 0 0 1rem">`;
      const keys = Object.keys(data[mod]).map(k=>Number(k)).sort((a,b)=>a-b);
      keys.forEach(q => {
        const val = data[mod][q];
        const ok = (highlight[mod] && highlight[mod][q] !== undefined) ? highlight[mod][q] : null;
        const cls = ok===true ? 'correct' : ok===false ? 'wrong' : '';
        const icon = ok===true ? '✔' : ok===false ? '✘' : '';
        html += `<li>Q${q}: <span class="${cls}">${escapeHtml(String(val))}</span> ${icon}</li>`;
      });
      html += `</ul></div>`;
    }
    out.innerHTML = html || '<em>No answers saved yet.</em>';
  }

  function modLabel(key) {
    if (key === 'rw1') return 'Reading & Writing — Module 1';
    if (key === 'rw2') return 'Reading & Writing — Module 2';
    if (key === 'm1') return 'Math — Module 1';
    if (key === 'm2') return 'Math — Module 2';
    return key;
  }

  function normalize(ans) { if (ans === null || ans === undefined) return ''; return String(ans).trim(); }

  function isAnswerCorrect(userRaw, correctRaw) {
    const user = normalize(userRaw);
    const correct = normalize(correctRaw);
    if (user === '') return false;
    if (/^[A-Za-z]$/.test(correct)) return user.toUpperCase() === correct.toUpperCase();
    const userNum = parseFloat(user.replace(',', '.'));
    const corrNum = parseFloat(correct.replace(',', '.'));
    if (!isNaN(userNum) && !isNaN(corrNum)) {
      const diff = Math.abs(userNum - corrNum);
      return diff < 0.05 || (Math.abs((userNum - corrNum) / Math.max(1, Math.abs(corrNum))) < 0.02);
    }
  const variants = correct.split(/[;\/,]/).map(s => s.trim()).filter(Boolean);
    if (variants.length > 1) {
      for (const v of variants) { if (isAnswerCorrect(user, v)) return true; }
    }
    return user.toLowerCase() === correct.toLowerCase();
  }

  function gradeAll() {
    const stored = loadStored();
    const modules = ['rw1','rw2','m1','m2'];
    const highlights = {};
    const results = {};
    for (const mod of modules) {
      const keySet = CORRECT[mod] || {};
      const saved = stored[mod] || {};
      let correctCount = 0;
      highlights[mod] = {};
      for (const qStr of Object.keys(keySet)) {
        const q = Number(qStr);
        const right = keySet[q];
        const userAns = saved[q] !== undefined ? saved[q] : '';
        const ok = isAnswerCorrect(userAns, right);
        if (ok) correctCount++;
        highlights[mod][q] = ok;
      }
      results[mod] = { correct: correctCount, total: Object.keys(keySet).length };
    }
    const rwRaw = (results.rw1.correct || 0) + (results.rw2.correct || 0);
    const mathRaw = (results.m1.correct || 0) + (results.m2.correct || 0);
    function getRwRange(raw) { const r = Math.max(0, Math.min(raw, RW_RANGES.length - 1)); return RW_RANGES[r]; }
    function getMathRange(raw) { const r = Math.max(0, Math.min(raw, M_RANGES.length - 1)); return M_RANGES[r]; }
    const rwRange = getRwRange(rwRaw);
    const mathRange = getMathRange(mathRaw);
    let outHtml = `<div class="summary"><strong>Raw scores:</strong> Reading & Writing: ${rwRaw} / 54 — Math: ${mathRaw} / 44</div>`;
    outHtml += `<div style="margin-top:.75rem">`;
    for (const mod of modules) {
      const r = results[mod];
      if (!r) continue;
      outHtml += `<h4 style="margin-top:.75rem">${modLabel(mod)} — ${r.correct} / ${r.total} correct</h4>`;
      outHtml += `<table class="result-table"><thead><tr><th>Q</th><th>Your</th><th>Answer</th><th>Status</th></tr></thead><tbody>`;
      const keySet = CORRECT[mod];
      const saved = loadStored()[mod] || {};
      const qs = Object.keys(keySet).map(x=>Number(x)).sort((a,b)=>a-b);
      qs.forEach(q=>{
        const userAns = saved[q] !== undefined ? saved[q] : '';
        const correctAns = keySet[q] || '';
        const ok = highlights[mod][q];
        outHtml += `<tr><td>${q}</td><td>${escapeHtml(String(userAns))}</td><td>${escapeHtml(String(correctAns))}</td><td>${ok ? '<span class="correct">✔</span>' : '<span class="wrong">✘</span>'}</td></tr>`;
      });
      outHtml += `</tbody></table>`;
    }
    outHtml += `</div>`;
    outHtml += `<div style="margin-top:1rem" class="summary"><strong>Scaled score ranges:</strong><br>`;
    outHtml += `Reading & Writing section: ${rwRange[0]} – ${rwRange[1]}<br>`;
    outHtml += `Math section: ${mathRange[0]} – ${mathRange[1]}</div>`;
    document.getElementById('grading-results').innerHTML = outHtml;
    renderSavedAnswers(highlights);
  }
function updateAnswerInputUI() {
  // Always show MCQ options for every module (including math)
  const mcqArea = document.getElementById('mcq-area');
  const numericArea = document.getElementById('numeric-area');
  if (mcqArea) mcqArea.style.display = 'block';
  if (numericArea) numericArea.style.display = 'none';

  // Clear numeric box and radios for a clean start
  const txt = document.getElementById('ans-choice-text');
  if (txt) txt.value = '';

  document.querySelectorAll('input[name="mcq"]').forEach(r => r.checked = false);
  document.querySelectorAll('#mcq-area label').forEach(l => l.classList.remove('selected'));
}


  // set label selected state when radio chosen (visual feedback)
  document.addEventListener('click', (e) => {
    if (e.target && e.target.name === 'mcq') {
      document.querySelectorAll('#mcq-area label').forEach(l => l.classList.remove('selected'));
      const parent = e.target.closest('label');
      if (parent) parent.classList.add('selected');
    }
  });

  function saveAnswerFromUI() {
    const mod = document.getElementById('ans-module').value;
    const qRaw = document.getElementById('ans-q').value;
    const q = Number(qRaw);
    if (!q || q < 1) { alert('Enter a valid question number'); return; }
    let answerVal = '';
    // if math module -> use text input
    if (mod && mod.startsWith('m')) {
      answerVal = document.getElementById('ans-choice-text').value.trim();
      if (answerVal === '') {
        if (!confirm('You entered a blank numeric answer. Save as blank?')) return;
      }
    } else {
      const sel = document.querySelector('input[name="mcq"]:checked');
      if (!sel) { alert('Choose an option (A/B/C/D or blank) before saving.'); return; }
      answerVal = sel.value; // may be '' when blank selected
    }
    const stored = loadStored();
    if (!stored[mod]) stored[mod] = {};
    stored[mod][q] = answerVal;
    storeAnswers(stored);
    renderSavedAnswers();
    document.getElementById('ans-q').value = '';
    if (mod && mod.startsWith('m')) {
      document.getElementById('ans-choice-text').value = '';
    } else {
      document.querySelectorAll('input[name="mcq"]').forEach(r => r.checked = false);
      document.querySelectorAll('#mcq-area label').forEach(l => l.classList.remove('selected'));
    }
  }

  // CSV export unchanged
  function exportCSV() {
    const store = loadStored();
    let csv = 'module,question,answer\n';
    Object.keys(store).forEach(mod=>{
      Object.keys(store[mod]).forEach(q => {
        const a = store[mod][q];
        csv += `${mod},${q},"${String(a).replace(/\"/g,'""')}"\n`;
      });
    });
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'uq_answers_export.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }

  // --- Timer implementation (basic start / pause / reset)
  let timerInterval = null;
  let remainingSeconds = 0;
  let currentModuleKey = null;

  function formatTime(sec) {
    const m = Math.floor(sec/60).toString().padStart(2,'0');
    const s = (sec%60).toString().padStart(2,'0');
    return `${m}:${s}`;
  }

  function setTimerForMins(mins) {
    remainingSeconds = Math.max(0, Math.floor(mins*60));
    document.getElementById('timer').textContent = formatTime(remainingSeconds);
  }

  function startTimer() {
    if (timerInterval) return; // already running
    timerInterval = setInterval(()=>{
      if (remainingSeconds <= 0) { clearInterval(timerInterval); timerInterval = null; alert('Time is up for this module'); return; }
      remainingSeconds--;
      document.getElementById('timer').textContent = formatTime(remainingSeconds);
    }, 1000);
    document.getElementById('pause').textContent = 'Pause';
    document.getElementById('pause').disabled = false;
  }

  function pauseTimer() {
    if (timerInterval) { clearInterval(timerInterval); timerInterval = null; document.getElementById('pause').textContent = 'Resume'; }
    else { startTimer(); }
  }

  function resetTimer() {
    if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
    const btn = document.querySelector('button[data-name="'+(currentModuleKey||'')+'"]');
    if (btn) {
      const mins = Number(btn.getAttribute('data-mins')) || 0;
      setTimerForMins(mins);
      document.getElementById('pause').textContent = 'Start';
      document.getElementById('pause').disabled = false;
    } else {
      remainingSeconds = 0; document.getElementById('timer').textContent = '00:00'; document.getElementById('pause').disabled = true; document.getElementById('pause').textContent = 'Start';
    }
  }

  // Finish module: stop timer and mark module finished
  function finishModule() {
    if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
    document.getElementById('current-module').textContent = 'Finished';
    document.getElementById('pause').disabled = true;
  }

  // wire up UI events for answers
  document.getElementById('ans-module').addEventListener('change', updateAnswerInputUI);
  document.getElementById('save-answer').addEventListener('click', saveAnswerFromUI);
  document.getElementById('download-answers').addEventListener('click', exportCSV);
  document.getElementById('check-answers').addEventListener('click', gradeAll);

  // initialisation
  updateAnswerInputUI();
  renderSavedAnswers();

  // convenience: module buttons jump PDF and enable start
  document.querySelectorAll('button[data-start]').forEach(btn => {
    btn.addEventListener('click', () => {
      const start = btn.getAttribute('data-start');
      const name = btn.getAttribute('data-name');
      const mins = Number(btn.getAttribute('data-mins')) || 0;
      const iframe = document.getElementById('pdf-frame');
      if (start && start !== '-') {
        iframe.src = 'tests/practice/sat-practice-test-4-digital.pdf#page=' + start;
      }
      currentModuleKey = name || null;
      document.getElementById('current-module').textContent = modLabel(name || '') || name;
      // set timer
      setTimerForMins(mins);
      // enable start/pause
      const pauseBtn = document.getElementById('pause');
      pauseBtn.disabled = false;
      pauseBtn.textContent = 'Start';
      // visually highlight selected module
      document.querySelectorAll('#module-controls button').forEach(b=>b.classList.remove('selected'));
      btn.classList.add('selected');
      // also select the matching option in answer sheet
      const ansSel = document.getElementById('ans-module');
      if (name && ['rw1','rw2','m1','m2'].includes(name)) ansSel.value = name;
      updateAnswerInputUI();
    });
  });

  // top-level section buttons (jump to the first module of the section)
  document.getElementById('btn-rw').addEventListener('click', (e) => {
    const start = e.target.getAttribute('data-start');
    const defaultMod = e.target.getAttribute('data-default-mod');
    const iframe = document.getElementById('pdf-frame');
    iframe.src = 'tests/practice/sat-practice-test-4-digital.pdf#page=' + start;
    // find the module button for rw1 and simulate click to set timer etc.
    const targetBtn = document.querySelector('button[data-name="'+defaultMod+'"]');
    if (targetBtn) targetBtn.click();
  });

  document.getElementById('btn-math').addEventListener('click', (e) => {
    const start = e.target.getAttribute('data-start');
    const defaultMod = e.target.getAttribute('data-default-mod');
    const iframe = document.getElementById('pdf-frame');
    iframe.src = 'tests/practice/sat-practice-test-4-digital.pdf#page=' + start;
    const targetBtn = document.querySelector('button[data-name="'+defaultMod+'"]');
    if (targetBtn) targetBtn.click();
  });

  // start / pause / reset / finish wiring
  document.getElementById('pause').addEventListener('click', () => {
    // if labeled Start -> begin countdown
    const v = document.getElementById('pause').textContent.toLowerCase();
    if (v.includes('start') || v.includes('resume')) {
      startTimer();
    } else {
      pauseTimer();
    }
  });
  document.getElementById('reset').addEventListener('click', resetTimer);
  document.getElementById('finish').addEventListener('click', finishModule);

  </script>
</body>
</html>
